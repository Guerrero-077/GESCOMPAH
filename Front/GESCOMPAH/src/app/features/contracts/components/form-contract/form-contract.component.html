<mat-stepper linear #stepper>
  <!-- Step 1 -->
  <mat-step [stepControl]="personFormGroup">
    <form [formGroup]="personFormGroup" class="container py-3">
      <ng-template matStepLabel>
        {{ stepper.selectedIndex === 0 ? 'Información del Arrendatario' : 'Información...' }}
      </ng-template>

      <!-- Encabezado -->
      <h5 class="border-bottom pb-1 mb-3">Datos de Identificación</h5>

      <!-- Documento -->
      <div class="mb-3">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Documento de Identidad</mat-label>
          <input
            matInput
            appDocumentFormat
            formControlName="document"
            placeholder="1.234.567"
            maxlength="14"
            inputmode="numeric"
            required
          />
          <mat-spinner *ngIf="loadingPerson" matSuffix diameter="20"></mat-spinner>
          <app-form-error [control]="personFormGroup.get('document')" label="Documento de Identidad" [messages]="docMessages"></app-form-error>
        </mat-form-field>
      </div>

      <!-- Nombres y apellidos -->
      <div class="row">
        <div class="col-md-6 mb-3">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Nombres</mat-label>
            <input matInput formControlName="firstName" placeholder="Carlos Alberto" />
            <app-form-error [control]="personFormGroup.get('firstName')" label="Nombres" [messages]="firstNameMessages"></app-form-error>
          </mat-form-field>
        </div>
        <div class="col-md-6 mb-3">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Apellidos</mat-label>
            <input matInput formControlName="lastName" placeholder="García Rodríguez" />
            <app-form-error [control]="personFormGroup.get('lastName')" label="Apellidos" [messages]="lastNameMessages"></app-form-error>
          </mat-form-field>
        </div>
      </div>

      <!-- Contacto -->
      <h5 class="border-bottom pb-1 mb-3">Información de Contacto</h5>
      <div class="row">
        <div class="col-md-6 mb-3">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Teléfono Celular</mat-label>
            <input matInput formControlName="phone" placeholder="3012345678" />
            <app-form-error [control]="personFormGroup.get('phone')" label="Teléfono" [messages]="phoneMessages"></app-form-error>
          </mat-form-field>
        </div>
        <div class="col-md-6 mb-3">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Correo Electrónico</mat-label>
            <input matInput type="email" formControlName="email" placeholder="correo@dominio.com" />
            <app-form-error [control]="personFormGroup.get('email')" label="Correo Electrónico" [messages]="emailMessages"></app-form-error>
          </mat-form-field>
        </div>
      </div>

      <!-- Botones -->
      <div class="d-flex justify-content-end gap-2 mt-3">
        <app-standard-button
          text="Cancelar"
          variant="stroked"
          color="warn"
          (clicked)="cancel()">
        </app-standard-button>

        <app-standard-button
          text="Siguiente"
          variant="raised"
          color="primary"
          [disabled]="personFormGroup.invalid"
          icon="arrow_forward"
          iconPosition="right"
          (clicked)="stepper.next()">
        </app-standard-button>
      </div>
    </form>
  </mat-step>

  <!-- Step 2 -->
  <mat-step [stepControl]="contractFormGroup">
    <form [formGroup]="contractFormGroup" class="container py-3">
      <ng-template matStepLabel>Detalles del Contrato</ng-template>

      <h5 class="border-bottom pb-1 mb-3">Información de Residencia</h5>
      <div class="row">
        <div class="col-md-6 mb-3">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Dirección</mat-label>
            <input matInput formControlName="address" placeholder="Calle 123 #45-67" />
            <app-form-error [control]="contractFormGroup.get('address')" label="Dirección" [messages]="addressMessages"></app-form-error>
          </mat-form-field>
        </div>
        <div class="col-md-6 mb-3">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Ciudad</mat-label>
            <mat-select formControlName="cityId">
              <mat-option *ngFor="let c of ciudades" [value]="c.id">{{ c.name }}</mat-option>
            </mat-select>
            <app-form-error [control]="contractFormGroup.get('cityId')" label="Ciudad"></app-form-error>
          </mat-form-field>
        </div>
      </div>

      <h5 class="border-bottom pb-1 mb-3">Período del Contrato</h5>
      <div class="row">
        <div class="col-md-6 mb-3">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Inicio</mat-label>
            <input matInput [matDatepicker]="pickerStart" formControlName="startDate" readonly />
            <mat-datepicker-toggle matSuffix [for]="pickerStart"></mat-datepicker-toggle>
            <mat-datepicker #pickerStart></mat-datepicker>
            <app-form-error [control]="contractFormGroup.get('startDate')" label="Fecha de inicio"></app-form-error>
          </mat-form-field>
        </div>
        <div class="col-md-6 mb-3">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Fin</mat-label>
            <input matInput [matDatepicker]="pickerEnd" formControlName="endDate" />
            <mat-datepicker-toggle matSuffix [for]="pickerEnd"></mat-datepicker-toggle>
            <mat-datepicker #pickerEnd></mat-datepicker>
            <app-form-error [control]="contractFormGroup.get('endDate')" label="Fecha de fin"></app-form-error>
            <app-form-error [control]="contractFormGroup" [messages]="dateRangeMessages"></app-form-error>
          </mat-form-field>
        </div>
      </div>

      <!-- Botones -->
      <div class="d-flex justify-content-end gap-2 mt-3">
        <app-standard-button
          text="Cancelar"
          variant="stroked"
          (clicked)="cancel()">
        </app-standard-button>

        <app-standard-button
          text="Atrás"
          variant="flat"
          color="yellow"
          icon="arrow_back"
          (clicked)="stepper.previous()">
        </app-standard-button>

        <app-standard-button
          text="Siguiente"
          variant="raised"
          color="primary"
          icon="arrow_forward"
          iconPosition="right"
          [disabled]="contractFormGroup.invalid"
          (clicked)="stepper.next()">
        </app-standard-button>
      </div>
    </form>
  </mat-step>

  <!-- Step 3 -->
  <mat-step [stepControl]="establishmentFormGroup">
    <form [formGroup]="establishmentFormGroup" class="container py-3">
      <ng-template matStepLabel>Establecimientos</ng-template>

      <h5 class="border-bottom pb-1 mb-3">Selección de Locales</h5>
      <div class="mb-3">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Plaza</mat-label>
          <mat-select formControlName="plazaId">
            <mat-option *ngFor="let p of plazas" [value]="p.id">{{ p.name }}</mat-option>
          </mat-select>
          <app-form-error [control]="establishmentFormGroup.get('plazaId')" label="Plaza"></app-form-error>
        </mat-form-field>
      </div>

      <div class="mb-3">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Locales</mat-label>
          <mat-select formControlName="establishmentIds" multiple>
            <mat-option *ngFor="let e of filteredEstablishments" [value]="e.id">
              {{ e.name }}
            </mat-option>
          </mat-select>
          <app-form-error [control]="establishmentFormGroup.get('establishmentIds')" label="Locales"></app-form-error>
        </mat-form-field>
      </div>

      <h5 class="border-bottom pb-1 mb-3">Cláusulas Adicionales</h5>
      <div class="mb-3">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Cláusulas</mat-label>
          <mat-select formControlName="clauseIds" multiple>
            <mat-option *ngFor="let c of clauses" [value]="c.id">{{ c.description }}</mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <!-- Botones -->
      <div class="d-flex justify-content-end gap-2 mt-3">
        <app-standard-button
          text="Cancelar"
          variant="stroked"
          (clicked)="cancel()">
        </app-standard-button>

        <app-standard-button
          text="Atrás"
          variant="flat"
          color="yellow"
          icon="arrow_back"
          (clicked)="stepper.previous()">
        </app-standard-button>

          <app-standard-button
          text="Crear contrato"
          variant="raised"
          color="primary"
          icon="save"
          [disabled]="establishmentFormGroup.invalid || saving"
          [loading]="saving"
          (clicked)="submit()">
        </app-standard-button>

      </div>
    </form>
  </mat-step>
</mat-stepper>
