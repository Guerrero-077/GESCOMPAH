<mat-card class="form-card">
  <mat-card-header>
    <mat-card-title>Tu Información Personal</mat-card-title>
    <mat-card-subtitle>Actualiza tus datos personales.</mat-card-subtitle>
  </mat-card-header>
  <mat-card-content>
    <div *ngIf="isLoading" class="spinner-container">
      <mat-spinner></mat-spinner>
    </div>

    <form [formGroup]="form" *ngIf="!isLoading" class="form-container">
      
      <div class="section-header">
        <h4>Información Personal</h4>
      </div>
      
      <div class="form-grid two-cols">
        <mat-form-field class="form-field" appearance="outline">
          <mat-label>Nombres</mat-label>
          <input matInput formControlName="firstName" placeholder="Carlos Alberto">
          <app-form-error [control]="form.get('firstName')" label="Nombres" [messages]="firstNameMessages"></app-form-error>
        </mat-form-field>

        <mat-form-field class="form-field" appearance="outline">
          <mat-label>Apellidos</mat-label>
          <input matInput formControlName="lastName" placeholder="García Rodríguez">
          <app-form-error [control]="form.get('lastName')" label="Apellidos" [messages]="lastNameMessages"></app-form-error>
        </mat-form-field>
      </div>

      <div class="form-grid two-cols">
        <mat-form-field class="form-field" appearance="outline">
          <mat-label>Documento</mat-label>
          <input matInput formControlName="document" readonly placeholder="12345678">
          <app-form-error [control]="form.get('document')" label="Documento" [messages]="documentMessages"></app-form-error>
          <mat-hint>Número de cédula de ciudadanía (7 a 10 dígitos)</mat-hint>
        </mat-form-field>

        <mat-form-field class="form-field" appearance="outline">
          <mat-label>Teléfono</mat-label>
          <input matInput formControlName="phone" placeholder="3012345678">
          <app-form-error [control]="form.get('phone')" label="Teléfono" [messages]="phoneMessages"></app-form-error>
          <mat-hint>Número celular colombiano de 10 dígitos</mat-hint>
        </mat-form-field>
      </div>

      <div class="section-header">
        <h4>Información de Contacto</h4>
      </div>
      
      <mat-form-field class="w-full" appearance="outline">
        <mat-label>Email</mat-label>
        <input matInput formControlName="email" readonly placeholder="carlos.garcia@gmail.com">
        <app-form-error [control]="form.get('email')" label="Email" [messages]="emailMessages"></app-form-error>
        <mat-hint>Se usará para el acceso al sistema y notificaciones</mat-hint>
      </mat-form-field>

      <mat-form-field class="w-full" appearance="outline">
        <mat-label>Dirección</mat-label>
        <input matInput formControlName="address" placeholder="Calle 26 # 47 - 15 Apto 302">
        <app-form-error [control]="form.get('address')" label="Dirección"></app-form-error>
        <mat-hint>Dirección completa donde reside actualmente</mat-hint>
      </mat-form-field>

      <div class="section-header">
        <h4>Información Geográfica</h4>
      </div>
      
      <div class="form-grid two-cols">
        <mat-form-field class="form-field" appearance="outline">
          <mat-label>Departamento</mat-label>
          <mat-select formControlName="departmentId">
            <mat-option *ngFor="let dept of departments$ | async" [value]="dept.id">
              {{ dept.name }}
            </mat-option>
          </mat-select>
          <app-form-error [control]="form.get('departmentId')" label="Departamento"></app-form-error>
          <mat-hint>Seleccione el departamento donde reside</mat-hint>
        </mat-form-field>

        <mat-form-field class="form-field" appearance="outline">
          <mat-label>Ciudad</mat-label>
          <mat-select formControlName="cityId">
            <mat-option *ngFor="let city of cities$ | async" [value]="city.id">
              {{ city.name }}
            </mat-option>
          </mat-select>
          <app-form-error [control]="form.get('cityId')" label="Ciudad" [messages]="cityIdMessages"></app-form-error>
          <mat-hint>Seleccione la ciudad de residencia</mat-hint>
        </mat-form-field>
      </div>

    </form>
  </mat-card-content>
  <mat-card-actions class="form-actions">
    <app-standard-button
      text="Guardar Cambios"
      variant="raised"
      color="primary"
      icon="save"
      iconPosition="left"
      [loading]="isSaving"
      loadingText="Guardando..."
      (clicked)="onSubmit()"
      [disabled]="form.invalid || isSaving">
    </app-standard-button>
  </mat-card-actions>
</mat-card>
